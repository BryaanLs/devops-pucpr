name: Notify Discord on Push

on:
  workflow_dispatch:
  push:

jobs:
  discord-notify:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the repository
        uses: actions/checkout@v2

      - name: Send notification to Discord
        run: |
          curl -H "Content-Type: application/json" \
          -d "$(cat <<EOF
          {
            "username": "Gandalf",
            "embeds": [{
              "title": "Novo push na branch: \"${{ github.ref_name }}\"",
              "description": "**Autor:** ${GITHUB_ACTOR}\n**Mensagem:** ${GITHUB_EVENT_HEAD_COMMIT_MESSAGE}",
              "url": "${GITHUB_EVENT_HEAD_COMMIT_URL}",
              "color": 3447003,
              "fields": [
                {
                  "name": "RepositÃ³rio",
                  "value": "${GITHUB_REPOSITORY}",
                  "inline": true
                },
                {
                  "name": "Branch",
                  "value": "${GITHUB_REF_NAME}",
                  "inline": true
                },
                {
                  "name": "Commit URL",
                  "value": "[View Commit](${GITHUB_EVENT_HEAD_COMMIT_URL})"
                }
              ],
              "footer": {
                "text": "GitHub Actions",
                "icon_url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
              },
              "timestamp": "$(date --utc +%FT%TZ)"
            }]
          }
          )" \
          "${{ secrets.DISCORD_WEBHOOK_URL }}"
