name: Notify Discord on Push

on:
  workflow_dispatch:
  push:

jobs:
  discord-notify:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the repository
        uses: actions/checkout@v2

      - name: Send notification to Discord
        run: |
          curl -H "Content-Type: application/json" \
          -d '{
                "username": "Gandalf💍",
                "embeds": [{
                  "title": "🫸🏻| Novo push na branch: '${{ github.ref_name }}'",
                  "description": "**🙋🏻| Autor:** '${{ github.actor }}'\n**📨| Mensagem:** '${{ github.event.head_commit.message }}'",
                  "url": "'${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}'",
                  "color": 3447003,
                  "fields": [
                    {
                      "name": "📦| Repository",
                      "value": "'${{ github.repository }}'",
                      "inline": true
                    },
                    {
                      "name": "🌿| Branch",
                      "value": "'${{ github.ref_name }}'",
                      "inline": true
                    },
                    {
                      "name": "🔗| Commit URL",
                      "value": "👀| [View Commit](${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }})"
                    }
                  ],
                  "footer": {
                    "text": "GitHub Actions",
                    "icon_url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"
                  },
                  "timestamp": "'$(date --utc +%FT%TZ)'"
                }]
              }' \
          "${{ secrets.DISCORD_WEBHOOK_URL }}"
